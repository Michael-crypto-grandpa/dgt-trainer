<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>DGT iPhone Trainer ‚Äî Easy Reading (EN)</title>
  <meta name="description" content="Simple offline trainer for Spain's theory test. Practice & exam modes, images, per-user progress. 'Lectura F√°cil' style (unofficial)." />
  <style>
    :root{ --bg:#0b0f14; --panel:#121821; --card:#18202b; --ink:#e7eef7; --muted:#a9b7c8; --acc:#5bd4ff; --good:#1ec28b; --bad:#ff6b6b}
    *{box-sizing:border-box}
    html,body{margin:0; height:100%; font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--ink)}
    .wrap{max-width:900px; margin:0 auto; padding:max(12px,env(safe-area-inset-top)) 12px calc(12px + env(safe-area-inset-bottom));}
    header{position:sticky; top:0; z-index:10; background:linear-gradient(180deg, rgba(11,15,20,.98) 80%, rgba(11,15,20,0)); backdrop-filter:saturate(1.2) blur(8px); border-bottom:1px solid rgba(255,255,255,.05); padding:8px 4px}
    h1{margin:0; font-size:20px}
    .subtitle{color:var(--muted); font-size:12px}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .grow{flex:1}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px}
    .btn{background:#10161f; border:1px solid rgba(255,255,255,.1); color:var(--ink); padding:10px 12px; border-radius:12px; font-weight:600; cursor:pointer}
    .btn.small{padding:8px 10px; font-weight:500}
    .btn.primary{background:linear-gradient(180deg,#1a5cff,#147aff)}
    .btn.ghost{background:transparent}
    .seg{display:flex; gap:6px; background:rgba(255,255,255,.04); padding:4px; border-radius:12px; border:1px solid rgba(255,255,255,.06)}
    .seg button{flex:1; padding:8px 10px; border:none; border-radius:10px; font-weight:600; color:var(--ink); background:transparent}
    .seg button.active{background:var(--acc); color:#00131f}
    .qtxt{font-size:18px; line-height:1.35}
    .choices{display:grid; gap:8px}
    .choice{display:flex; gap:10px; align-items:flex-start; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07); padding:10px 12px; border-radius:12px; cursor:pointer}
    .choice.correct{outline:2px solid var(--good)}
    .choice.incorrect{outline:2px solid var(--bad)}
    .muted{color:var(--muted)}
    .bar{height:8px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden}
    .bar>span{display:block; height:100%; background:linear-gradient(90deg,#5bd4ff,#1ec28b)}
    .image{width:100%; border-radius:12px; border:1px solid rgba(255,255,255,.06)}
    .hidden{display:none!important}
    input[type="text"], select{background:#0f141c; color:var(--ink); border:1px solid rgba(255,255,255,.1); border-radius:10px; padding:10px 12px; width:100%}
    label.file{display:inline-flex; align-items:center; gap:8px; cursor:pointer}
    input[type="file"]{display:none}
    .grid{display:grid; gap:10px}
    .two{grid-template-columns:1fr}
    @media(min-width:740px){.two{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row" style="justify-content:space-between; align-items:flex-start">
        <div>
          <h1>üìò DGT iPhone Trainer ‚Äî Easy Reading</h1>
          <div class="subtitle">Train for the Spanish theory test. iPhone-ready, offline progress per profile.</div>
        </div>
        <div class="row">
          <div class="seg" role="tablist">
            <button id="modePractice" class="active">Practice</button>
            <button id="modeExam">Exam</button>
          </div>
          <button id="btnSettings" class="btn small">‚öôÔ∏è Settings</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap" style="display:grid; gap:12px">
    <section id="settingsPanel" class="card hidden">
      <div class="grid two">
        <div class="card" style="background:#111723">
          <h3 style="margin:0 0 10px">Profile & language</h3>
          <label>Profile name (separate progress)
            <input type="text" id="profileName" placeholder="e.g., Michael or Masha" />
          </label>
          <label>Interface language
            <select id="uiLang"><option value="en">English</option><option value="es">Espa√±ol</option><option value="ru">–†—É—Å—Å–∫–∏–π</option></select>
          </label>
          <div class="muted">Tip: use different profile names so each of you keeps your own progress.</div>
        </div>
        <div class="card" style="background:#111723">
          <h3 style="margin:0 0 10px">Data</h3>
          <div class="grid">
            <div class="row">
              <label class="file btn small">üì• Import questions (JSON)
                <input type="file" id="importFile" accept="application/json" />
              </label>
              <button id="btnExport" class="btn small">üì§ Export (Q&A + progress)</button>
            </div>
            <button id="btnLoadLF" class="btn small">‚¨áÔ∏è Load ‚ÄúEasy Reading‚Äù pack (included)</button>
            <button id="btnReset" class="btn small" style="background:#2a0f14;border-color:#5a1b22">‚ôªÔ∏è Reset progress</button>
            <details>
              <summary>üìÑ JSON format example</summary>
<pre style="white-space:pre-wrap; font-size:12px; color:#cfe8ff; background:#0c121a; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.08)">[
  {
    "id": 1,
    "topic": "Signs",
    "image": "https://‚Ä¶ or data:image/png;base64,‚Ä¶",
    "question": {"en": "What does this sign mean?"},
    "choices": [
      {"id":"A","text":{"en":"Give way"}},
      {"id":"B","text":{"en":"Stop"}},
      {"id":"C","text":{"en":"No overtaking"}}
    ],
    "correct": ["B"],
    "explanation": {"en": "Octagonal red sign means STOP."}
  }
]</pre>
              <div class="muted">Educational pack; not an official DGT database.</div>
            </details>
          </div>
        </div>
      </div>
      <div class="row" style="justify-content:flex-end"><button id="btnCloseSettings" class="btn">Done</button></div>
    </section>

    <section class="card">
      <div class="row" style="align-items:center; gap:10px">
        <div class="grow">
          <div class="bar"><span id="progressBar" style="width:0%"></span></div>
          <div class="muted" id="progressText" style="margin-top:6px">0 / 0</div>
        </div>
        <div class="row">
          <button id="btnPrev" class="btn small">‚óÄÔ∏é Back</button>
          <button id="btnNext" class="btn small">Next ‚ñ∂Ô∏é</button>
        </div>
      </div>
    </section>

    <section id="qa" class="card" aria-live="polite" style="display:grid; gap:10px">
      <div id="topic" class="muted"></div>
      <img id="qImage" class="image hidden" alt="Question image" />
      <div id="qText" class="qtxt"></div>
      <div id="choices" class="choices"></div>
      <div id="explain" class="muted hidden"></div>
      <div class="row">
        <button id="btnCheck" class="btn primary">Check</button>
        <button id="btnReveal" class="btn ghost">Reveal answer</button>
        <button id="btnMarkHard" class="btn ghost">‚òÖ Hard</button>
      </div>
    </section>

    <section id="examPanel" class="card hidden">
      <div class="grid two">
        <div class="card" style="background:#111723">
          <h3 style="margin:0 0 10px">Exam</h3>
          <label># of questions
            <input type="text" id="examCount" inputmode="numeric" value="30" />
          </label>
          <label>Shuffle
            <select id="examShuffle"><option value="1">Yes</option><option value="0">No</option></select>
          </label>
          <button id="btnStartExam" class="btn">Start</button>
        </div>
        <div class="card" style="background:#111723">
          <h3 style="margin:0 0 10px">Results</h3>
          <div id="examStats" class="muted">No attempts yet.</div>
          <div id="examReview" class="grid" style="gap:6px"></div>
        </div>
      </div>
    </section>

    <footer class="muted" style="text-align:center; padding:18px 0 8px">
      <div>To add on iPhone: in Safari tap <strong>Share ‚Üí Add to Home Screen</strong>.</div>
      <div style="margin-top:6px">Data is stored locally on your device. Educational tool (not official DGT).</div>
    </footer>
  </main>

  <script>
  let UI_LANG = localStorage.getItem('uiLang') || 'en';
  let PROFILE = localStorage.getItem('profileName') || 'Michael';

  const builtinQuestions = [
    {
      "id": 3001,
      "topic": "Lights",
      "image": null,
      "question": {"en": "During the day, is it obligatory to turn on the vehicle‚Äôs lights when driving through certain areas?"},
      "choices": [
        {"id": "A", "text": {"en": "Yes, for example when driving over a movable bridge."}},
        {"id": "B", "text": {"en": "Yes, for example when driving in a tunnel or underpass."}},
        {"id": "C", "text": {"en": "Yes, for example when driving on a high-occupancy vehicle lane."}}
      ],
      "correct": ["B"],
      "explanation": {"en": "In Spain, the law requires using low-beam headlights during the day in tunnels, underpasses or stretches marked with the \"Tunnel\" sign (S-5). This is for safety due to the reduced visibility inside such areas."}
    },
    {
      "id": 3002,
      "topic": "Priority",
      "image": null,
      "question": {"en": "What is the order of priority among traffic signals, traffic lights, and police officers directing traffic?"},
      "choices": [
        {"id": "A", "text": {"en": "Traffic signs, then police officers, then traffic lights."}},
        {"id": "B", "text": {"en": "Police officers, then traffic lights, then traffic signs."}},
        {"id": "C", "text": {"en": "Traffic lights, then police officers, then traffic signs."}}
      ],
      "correct": ["B"],
      "explanation": {"en": "A police officer‚Äôs orders override any other signals. If no officer is present, traffic lights have priority over static signs. Therefore, the hierarchy is: first obey police officers, then traffic lights, and finally road signs."}
    },
    {
      "id": 3003,
      "topic": "Signs",
      "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Spain_traffic_signal_r114.svg/1024px-Spain_traffic_signal_r114.svg.png",
      "question": {"en": "This road sign indicates no entry for which kind of vehicles?"},
      "choices": [
        {"id": "A", "text": {"en": "No entry for bicycles and mopeds."}},
        {"id": "B", "text": {"en": "No entry for bicycles (cycles)."}},
        {"id": "C", "text": {"en": "No entry for any two-wheeled vehicles."}}
      ],
      "correct": ["B"],
      "explanation": {"en": "The depicted sign (a red circle with a bicycle) means entry prohibited to cycles (bicycles). It specifically forbids bicycles, but not other two-wheelers like mopeds (those have a different sign)."}
    },
    {
      "id": 3004,
      "topic": "Drugs & driving",
      "image": null,
      "question": {"en": "In general, under the effects of cocaine a driver will..."},
      "choices": [
        {"id": "A", "text": {"en": "feel insecure and underestimate their abilities at the wheel."}},
        {"id": "B", "text": {"en": "concentrate better, making safer decisions."}},
        {"id": "C", "text": {"en": "become overly confident, competitive, and impulsive."}}
      ],
      "correct": ["C"],
      "explanation": {"en": "Stimulant drugs like cocaine can make drivers agitated, aggressive, and overconfident. A driver who has consumed cocaine tends to overestimate their abilities and drive in an impulsive, competitive manner, which increases risk."}
    },
    {
      "id": 3005,
      "topic": "Seat belt",
      "image": null,
      "question": {"en": "Are pregnant women required to wear a seat belt while traveling in a vehicle?"},
      "choices": [
        {"id": "A", "text": {"en": "Yes, as a general rule they must wear a seat belt."}},
        {"id": "B", "text": {"en": "No, because the seat belt could be dangerous for the unborn baby."}},
        {"id": "C", "text": {"en": "Only if it does not cause them discomfort while driving."}}
      ],
      "correct": ["A"],
      "explanation": {"en": "Since 2016, pregnant women are not exempt from wearing seat belts. They are required to buckle up just like any other driver or passenger (with very limited medical exceptions), because proper seat belt use greatly improves safety for both mother and fetus."}
    },
    {
      "id": 3006,
      "topic": "Heat & conditions",
      "image": null,
      "question": {"en": "High temperatures can negatively affect driving abilities. A driver exposed to intense heat usually:"},
      "choices": [
        {"id": "A", "text": {"en": "Reacts more slowly and tends to be less aggressive."}},
        {"id": "B", "text": {"en": "Reacts more slowly and tends to be more irritable or aggressive."}},
        {"id": "C", "text": {"en": "Reacts faster than usual due to being uncomfortable."}}
      ],
      "correct": ["B"],
      "explanation": {"en": "Extreme heat can impair a driver‚Äôs performance. Studies show that heat causes slower reaction times and increases aggressive or irritable behavior in drivers. For example, a car interior over 30 ¬∞C leads to significantly delayed reactions and more errors due to driver discomfort."}
    },
    {
      "id": 3007,
      "topic": "Hand signals",
      "image": null,
      "question": {"en": "If your car‚Äôs reverse light is broken, how should you signal that you intend to reverse the car?"},
      "choices": [
        {"id": "A", "text": {"en": "By moving your arm up and down outside the window."}},
        {"id": "B", "text": {"en": "By extending your arm out the window with your palm facing backward."}},
        {"id": "C", "text": {"en": "By using the horn intermittently as you reverse."}}
      ],
      "correct": ["B"],
      "explanation": {"en": "When the white reversing light is not working, you must give a hand signal. The correct arm signal for reversing is extending the left arm out with the palm facing backward. This alerts others that you are about to move in reverse."}
    },
    {
      "id": 3008,
      "topic": "Moped manoeuvres",
      "image": null,
      "question": {"en": "On a two-way single-lane road outside a town, where should a moped position itself to turn left if there is no dedicated left-turn lane?"},
      "choices": [
        {"id": "A", "text": {"en": "Move to the center of the road, without encroaching the opposite lane."}},
        {"id": "B", "text": {"en": "Stay in the center of its lane (middle of its lane) before turning."}},
        {"id": "C", "text": {"en": "Keep as far to the right edge of the road as possible, even off the road if there is space."}}
      ],
      "correct": ["C"],
      "explanation": {"en": "On interurban roads, two-wheeled cycles and mopeds must, if turning left and no dedicated lane exists, pull over to the far right edge or shoulder and wait there to make the left turn. This way they do not block faster vehicles coming behind them. They should only execute the left turn when it‚Äôs safe to do so."}
    },
    {
      "id": 3009,
      "topic": "Road markings",
      "image": null,
      "question": {"en": "This broken white line across the road at an intersection ‚Äì does it require you to stop before crossing it?"},
      "choices": [
        {"id": "A", "text": {"en": "Only if visibility is poor."}},
        {"id": "B", "text": {"en": "No, because not stopping poses no danger to traffic."}},
        {"id": "C", "text": {"en": "No, you only must stop if necessary to give way to other vehicles."}}
      ],
      "correct": ["C"],
      "explanation": {"en": "A broken transverse line on the road indicates a yield line. It marks a point where you must slow down and be prepared to stop to cede priority. You are not required to stop outright if the way is clear ‚Äì only stop if needed to let other vehicles (or pedestrians) pass, as indicated by a yield sign."}
    },
    {
      "id": 3010,
      "topic": "Fatigue",
      "image": null,
      "question": {"en": "To avoid the onset of drowsiness while driving, it is advisable to sleep..."},
      "choices": [
        {"id": "A", "text": {"en": "between 5 and 7 hours per day."}},
        {"id": "B", "text": {"en": "fewer hours than normal, to keep your alertness high."}},
        {"id": "C", "text": {"en": "at least 7 to 8 hours per day on a regular basis."}}
      ],
      "correct": ["C"],
      "explanation": {"en": "Getting sufficient sleep is one of the best ways to prevent driver fatigue. It‚Äôs recommended to sleep around 7‚Äì9 hours each night. In fact, Spain‚Äôs DGT advises sleeping a minimum of 7 hours before a long drive. Driving with less sleep greatly increases the risk of accidents."}
    }
  ];

  const $ = s=>document.querySelector(s); const $$ = s=>Array.from(document.querySelectorAll(s));
  const storeKey = p=>`dgt_trainer_en_v1::${p||'default'}`;
  const loadState = p=>{ try{return JSON.parse(localStorage.getItem(storeKey(p)))||{};}catch{return{}} };
  const saveState = (p,d)=>localStorage.setItem(storeKey(p), JSON.stringify(d));

  let DATA = { questions: [], progress:{seen:{},correct:{},hard:{}}, exams:[], practiceSel:{} };
  let MODE='practice'; let INDEX=0; let EXAM=null;

  function initData(){
    const saved = loadState(PROFILE);
    if(saved && saved.questions && saved.questions.length){ DATA=saved; }
    else { DATA.questions = builtinQuestions; saveState(PROFILE, DATA); }
  }

  function setMode(m){ MODE=m; $('#modePractice').classList.toggle('active',m==='practice'); $('#modeExam').classList.toggle('active',m==='exam'); $('#examPanel').classList.toggle('hidden', m!=='exam'); $('#qa').classList.toggle('hidden', m==='exam' && !EXAM); updateProgress(); }
  function updateProgress(){ const total = MODE==='exam' && EXAM? EXAM.order.length : DATA.questions.length; const current = MODE==='exam' && EXAM? (EXAM.order.indexOf(INDEX)+1) : (INDEX+1); $('#progressBar').style.width = (total?Math.round(current*100/total):0)+'%'; $('#progressText').textContent = `${current} / ${total}`; }
  function renderQuestion(){ const q = DATA.questions[INDEX]; if(!q) return; $('#topic').textContent = q.topic||''; const img=$('#qImage'); if(q.image){ img.src=q.image; img.classList.remove('hidden'); } else { img.classList.add('hidden'); } const qtxt = q.question[UI_LANG] || q.question.en || q.question.es || q.question.ru || ''; $('#qText').textContent = qtxt; const choices=$('#choices'); choices.innerHTML=''; (q.choices||[]).forEach(ch=>{ const lab=document.createElement('label'); lab.className='choice'; lab.dataset.id=ch.id; const ctext = ch.text[UI_LANG] || ch.text.en || ch.text.es || ch.text.ru || ''; lab.innerHTML = `<input type="checkbox" /> <div><strong>${ch.id}</strong>. ${ctext}</div>`; lab.addEventListener('click',e=>{ if(e.target.tagName.toLowerCase()!=='input'){ const inp=lab.querySelector('input'); inp.checked=!inp.checked; } }); choices.appendChild(lab); }); const prevSel = (MODE==='practice')? (DATA.practiceSel[q.id]||[]) : (EXAM && EXAM.answers ? (EXAM.answers[q.id]||[]) : []); prevSel.forEach(id=>{ const el=$(`#choices .choice[data-id="${id}"] input`); if(el) el.checked=true; }); $('#explain').classList.add('hidden'); $('#explain').textContent=''; updateProgress(); }
  function getSelected(){ return $$('#choices .choice').filter(c=>c.querySelector('input').checked).map(c=>c.dataset.id); }
  function markChoiceStates(correctSet, selected){ $$('#choices .choice').forEach(el=>{ const id=el.dataset.id; el.classList.remove('correct','incorrect'); if(selected.includes(id)){ el.classList.add(correctSet.has(id)?'correct':'incorrect'); } }); }
  function checkAnswer(showOnly=false){ const q = DATA.questions[INDEX]; const correctSet=new Set(q.correct||[]); const selected=getSelected(); if(MODE==='practice' && !showOnly){ DATA.practiceSel[q.id]=selected; } if(MODE==='exam' && EXAM && !showOnly){ EXAM.answers[q.id]=selected; } markChoiceStates(correctSet, showOnly? Array.from(correctSet): selected); if(!showOnly){ DATA.progress.seen[q.id]=(DATA.progress.seen[q.id]||0)+1; const right = selected.length===correctSet.size && selected.every(x=>correctSet.has(x)); if(right){ DATA.progress.correct[q.id]=(DATA.progress.correct[q.id]||0)+1; } saveState(PROFILE, DATA); } const ansLabel = 'Correct answer: '+ (q.correct||[]).join(', '); const expl = (q.explanation && (q.explanation[UI_LANG] || q.explanation.en || q.explanation.es || q.explanation.ru)) || ''; $('#explain').innerHTML = `<div style="margin-bottom:6px"><strong>${ansLabel}</strong></div>` + expl; $('#explain').classList.remove('hidden'); }
  function next(){ if(MODE==='exam' && EXAM){ const pos=EXAM.order.indexOf(INDEX); if(pos<EXAM.order.length-1){ INDEX=EXAM.order[pos+1]; renderQuestion(); } else { finishExam(); } } else { INDEX=(INDEX+1)%DATA.questions.length; renderQuestion(); } }
  function prev(){ if(MODE==='exam' && EXAM){ const pos=EXAM.order.indexOf(INDEX); if(pos>0){ INDEX=EXAM.order[pos-1]; renderQuestion(); } } else { INDEX=(INDEX-1+DATA.questions.length)%DATA.questions.length; renderQuestion(); } }
  function startExam(){ const all = DATA.questions.map((_,i)=>i); const count = Math.min(Math.max(parseInt($('#examCount').value||'30',10),1), all.length); const shuffled = $('#examShuffle').value==='1' ? all.sort(()=>Math.random()-0.5) : all; EXAM={ order: shuffled.slice(0,count), answers:{}, startedAt: Date.now() }; INDEX = EXAM.order[0]; $('#qa').classList.remove('hidden'); renderQuestion(); }
  function finishExam(){ let ok=0; const total = EXAM.order.length; const review=[]; EXAM.order.forEach(i=>{ const q=DATA.questions[i]; const sel=EXAM.answers[q.id]||[]; const set=new Set(q.correct||[]); const right = sel.length===set.size && sel.every(x=>set.has(x)); if(right) ok++; review.push({q, sel, right}); }); const attempt = {at:Date.now(), total, correct:ok}; DATA.exams.push(attempt); saveState(PROFILE, DATA); $('#examStats').textContent = `Result: ${ok} of ${total}`; const box=$('#examReview'); box.innerHTML=''; review.forEach(item=>{ const div=document.createElement('div'); div.className='muted'; const s=item.sel.join(', ')||'‚Äî'; const qtxt=(item.q.question && (item.q.question[UI_LANG]||item.q.question.en))||''; div.textContent = `${item.right?'‚úÖ':'‚ùå'} ${qtxt} | You: ${s} | OK: ${(item.q.correct||[]).join(', ')}`; box.appendChild(div); }); setMode('exam'); }
  function renderExamHistory(){ const box=$('#examReview'); box.innerHTML=''; if(!DATA.exams.length){ $('#examStats').textContent='No attempts yet.'; return; } const last=DATA.exams[DATA.exams.length-1]; $('#examStats').textContent=`Result: ${last.correct} / ${last.total}`; DATA.exams.slice().reverse().forEach(at=>{ const div=document.createElement('div'); div.className='muted'; div.textContent = `${new Date(at.at).toLocaleString()} ‚Äî ${at.correct}/${at.total}`; box.appendChild(div); }); }
  function openSettings(){ $('#settingsPanel').classList.remove('hidden'); $('#profileName').value=PROFILE; $('#uiLang').value=UI_LANG; }
  function closeSettings(){ PROFILE=($('#profileName').value||'default').trim()||'default'; UI_LANG=$('#uiLang').value||'en'; localStorage.setItem('profileName',PROFILE); localStorage.setItem('uiLang',UI_LANG); initData(); INDEX=0; renderQuestion(); renderExamHistory(); $('#settingsPanel').classList.add('hidden'); }
  $('#importFile').addEventListener('change', async (e)=>{ const f=e.target.files?.[0]; if(!f) return; try{ const text=await f.text(); const arr=JSON.parse(text); if(!Array.isArray(arr)||!arr.length) throw new Error('JSON must be an array.'); for(const q of arr){ if(typeof q.id==='undefined') q.id=Math.random().toString(36).slice(2); if(!q.question||!q.choices||!q.correct) throw new Error('Missing: question, choices, correct'); } DATA.questions=arr; DATA.progress={seen:{},correct:{},hard:{}}; DATA.practiceSel={}; saveState(PROFILE, DATA); INDEX=0; renderQuestion(); alert('Questions imported.'); }catch(err){ alert('Import error: '+err.message); } e.target.value=''; });
  $('#btnExport').addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`dgt_trainer_${PROFILE}.json`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1500); });
  $('#btnReset').addEventListener('click', ()=>{ if(confirm('Reset local progress?')){ DATA.progress={seen:{},correct:{},hard:{}}; DATA.practiceSel={}; DATA.exams=[]; saveState(PROFILE, DATA); alert('Progress reset.'); } });
  $('#btnLoadLF').addEventListener('click', ()=>{ if(confirm('Load the included ‚ÄúEasy Reading‚Äù pack? This will replace the current base.')){ DATA.questions=builtinQuestions; DATA.progress={seen:{},correct:{},hard:{}}; DATA.practiceSel={}; saveState(PROFILE, DATA); INDEX=0; renderQuestion(); alert('Pack loaded.'); } });
  $('#modePractice').addEventListener('click', ()=>{ setMode('practice'); $('#qa').classList.remove('hidden'); renderQuestion(); });
  $('#modeExam').addEventListener('click', ()=>{ setMode('exam'); renderExamHistory(); $('#qa').classList.add('hidden'); });
  $('#btnSettings').addEventListener('click', openSettings); $('#btnCloseSettings').addEventListener('click', closeSettings);
  $('#btnPrev').addEventListener('click', prev); $('#btnNext').addEventListener('click', next);
  $('#btnCheck').addEventListener('click', ()=>checkAnswer(false)); $('#btnReveal').addEventListener('click', ()=>checkAnswer(true));
  $('#btnMarkHard').addEventListener('click', ()=>{ const q=DATA.questions[INDEX]; DATA.progress.hard[q.id]=!DATA.progress.hard[q.id]; saveState(PROFILE, DATA); alert(DATA.progress.hard[q.id]?'Marked as hard.':'Hard mark removed.'); });
  $('#btnStartExam').addEventListener('click', startExam);
  (function(){ initData(); setMode('practice'); renderQuestion(); renderExamHistory(); document.addEventListener('touchstart',()=>{}, {passive:true}); })();
  </script>
</body>
</html>
